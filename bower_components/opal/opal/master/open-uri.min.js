Opal.modules.stringio=function(Opal){function $rb_ge(lhs,rhs){return"number"==typeof lhs&&"number"==typeof rhs?lhs>=rhs:lhs["$>="](rhs)}function $rb_gt(lhs,rhs){return"number"==typeof lhs&&"number"==typeof rhs?lhs>rhs:lhs["$>"](rhs)}function $rb_plus(lhs,rhs){return"number"==typeof lhs&&"number"==typeof rhs?lhs+rhs:lhs["$+"](rhs)}function $rb_minus(lhs,rhs){return"number"==typeof lhs&&"number"==typeof rhs?lhs-rhs:lhs["$-"](rhs)}var $nesting=(Opal.top,[]),nil=Opal.nil,$klass=(Opal.breaker,Opal.slice,Opal.klass),$truthy=Opal.truthy;return Opal.add_stubs(["$include","$new","$call","$close","$attr_accessor","$length","$include?","$!","$check_readable","$==","$===","$>=","$raise","$>","$+","$-","$seek","$enum_for","$eof?","$ord","$[]","$check_writable","$String","$write","$closed_write?","$closed_read?"]),function($base,$super,$parent_nesting){function $StringIO(){}var TMP_StringIO_open_1,TMP_StringIO_initialize_2,TMP_StringIO_eof$q_3,TMP_StringIO_seek_4,TMP_StringIO_tell_5,TMP_StringIO_rewind_6,TMP_StringIO_each_byte_7,TMP_StringIO_each_char_8,TMP_StringIO_write_9,TMP_StringIO_read_10,TMP_StringIO_close_11,TMP_StringIO_close_read_12,TMP_StringIO_close_write_13,TMP_StringIO_closed$q_14,TMP_StringIO_closed_read$q_15,TMP_StringIO_closed_write$q_16,TMP_StringIO_check_writable_17,TMP_StringIO_check_readable_18,self=$StringIO=$klass($base,$super,"StringIO",$StringIO),def=self.$$proto,$nesting=[self].concat($parent_nesting);return def.position=def.string=def.closed=nil,self.$include(Opal.const_get_qualified(Opal.const_get_relative($nesting,"IO"),"Readable")),self.$include(Opal.const_get_qualified(Opal.const_get_relative($nesting,"IO"),"Writable")),Opal.defs(self,"$open",TMP_StringIO_open_1=function(string,mode){var self=this,$iter=TMP_StringIO_open_1.$$p,block=$iter||nil,io=nil,res=nil;return null==string&&(string=""),null==mode&&(mode=nil),$iter&&(TMP_StringIO_open_1.$$p=null),io=self.$new(string,mode),res=block.$call(io),io.$close(),res},TMP_StringIO_open_1.$$arity=-1),self.$attr_accessor("string"),Opal.defn(self,"$initialize",TMP_StringIO_initialize_2=function(string,mode){var $a,self=this;return null==string&&(string=""),null==mode&&(mode="rw"),self.string=string,self.position=string.$length(),$truthy($truthy($a=mode["$include?"]("r"))?mode["$include?"]("w")["$!"]():$a)?self.closed="write":$truthy($truthy($a=mode["$include?"]("w"))?mode["$include?"]("r")["$!"]():$a)?self.closed="read":nil},TMP_StringIO_initialize_2.$$arity=-1),Opal.defn(self,"$eof?",TMP_StringIO_eof$q_3=function(){var self=this;return self.$check_readable(),self.position["$=="](self.string.$length())},TMP_StringIO_eof$q_3.$$arity=0),Opal.alias(self,"eof","eof?"),Opal.defn(self,"$seek",TMP_StringIO_seek_4=function(pos,whence){var self=this,$case=nil;return null==whence&&(whence=Opal.const_get_qualified(Opal.const_get_relative($nesting,"IO"),"SEEK_SET")),$case=whence,Opal.const_get_qualified(Opal.const_get_relative($nesting,"IO"),"SEEK_SET")["$==="]($case)?($truthy($rb_ge(pos,0))||self.$raise(Opal.const_get_qualified(Opal.const_get_relative($nesting,"Errno"),"EINVAL")),self.position=pos):Opal.const_get_qualified(Opal.const_get_relative($nesting,"IO"),"SEEK_CUR")["$==="]($case)?self.position=$truthy($rb_gt($rb_plus(self.position,pos),self.string.$length()))?self.string.$length():$rb_plus(self.position,pos):Opal.const_get_qualified(Opal.const_get_relative($nesting,"IO"),"SEEK_END")["$==="]($case)&&(self.position=$truthy($rb_gt(pos,self.string.$length()))?0:$rb_minus(self.position,pos)),0},TMP_StringIO_seek_4.$$arity=-2),Opal.defn(self,"$tell",TMP_StringIO_tell_5=function(){var self=this;return self.position},TMP_StringIO_tell_5.$$arity=0),Opal.alias(self,"pos","tell"),Opal.alias(self,"pos=","seek"),Opal.defn(self,"$rewind",TMP_StringIO_rewind_6=function(){var self=this;return self.$seek(0)},TMP_StringIO_rewind_6.$$arity=0),Opal.defn(self,"$each_byte",TMP_StringIO_each_byte_7=function(){var self=this,$iter=TMP_StringIO_each_byte_7.$$p,block=$iter||nil,i=nil;if($iter&&(TMP_StringIO_each_byte_7.$$p=null),!$truthy(block))return self.$enum_for("each_byte");for(self.$check_readable(),i=self.position;!$truthy(self["$eof?"]());)block.$call(self.string["$[]"](i).$ord()),i=$rb_plus(i,1);return self},TMP_StringIO_each_byte_7.$$arity=0),Opal.defn(self,"$each_char",TMP_StringIO_each_char_8=function(){var self=this,$iter=TMP_StringIO_each_char_8.$$p,block=$iter||nil,i=nil;if($iter&&(TMP_StringIO_each_char_8.$$p=null),!$truthy(block))return self.$enum_for("each_char");for(self.$check_readable(),i=self.position;!$truthy(self["$eof?"]());)block.$call(self.string["$[]"](i)),i=$rb_plus(i,1);return self},TMP_StringIO_each_char_8.$$arity=0),Opal.defn(self,"$write",TMP_StringIO_write_9=function(string){var self=this,before=nil,after=nil;return self.$check_writable(),string=self.$String(string),self.string.$length()["$=="](self.position)?(self.string=$rb_plus(self.string,string),self.position=$rb_plus(self.position,string.$length())):(before=self.string["$[]"](Opal.Range.$new(0,$rb_minus(self.position,1),!1)),after=self.string["$[]"](Opal.Range.$new($rb_plus(self.position,string.$length()),-1,!1)),self.string=$rb_plus($rb_plus(before,string),after),self.position=$rb_plus(self.position,string.$length()))},TMP_StringIO_write_9.$$arity=1),Opal.defn(self,"$read",TMP_StringIO_read_10=function(length,outbuf){var self=this,string=nil,str=nil;return null==length&&(length=nil),null==outbuf&&(outbuf=nil),self.$check_readable(),$truthy(self["$eof?"]())?nil:(string=function(){return $truthy(length)?(str=self.string["$[]"](self.position,length),self.position=$rb_plus(self.position,length),str):(str=self.string["$[]"](Opal.Range.$new(self.position,-1,!1)),self.position=self.string.$length(),str)}(),$truthy(outbuf)?outbuf.$write(string):string)},TMP_StringIO_read_10.$$arity=-1),Opal.defn(self,"$close",TMP_StringIO_close_11=function(){var self=this;return self.closed="both"},TMP_StringIO_close_11.$$arity=0),Opal.defn(self,"$close_read",TMP_StringIO_close_read_12=function(){var self=this;return self.closed=self.closed["$=="]("write")?"both":"read"},TMP_StringIO_close_read_12.$$arity=0),Opal.defn(self,"$close_write",TMP_StringIO_close_write_13=function(){var self=this;return self.closed=self.closed["$=="]("read")?"both":"write"},TMP_StringIO_close_write_13.$$arity=0),Opal.defn(self,"$closed?",TMP_StringIO_closed$q_14=function(){var self=this;return self.closed["$=="]("both")},TMP_StringIO_closed$q_14.$$arity=0),Opal.defn(self,"$closed_read?",TMP_StringIO_closed_read$q_15=function(){var $a,self=this;return $truthy($a=self.closed["$=="]("read"))?$a:self.closed["$=="]("both")},TMP_StringIO_closed_read$q_15.$$arity=0),Opal.defn(self,"$closed_write?",TMP_StringIO_closed_write$q_16=function(){var $a,self=this;return $truthy($a=self.closed["$=="]("write"))?$a:self.closed["$=="]("both")},TMP_StringIO_closed_write$q_16.$$arity=0),Opal.defn(self,"$check_writable",TMP_StringIO_check_writable_17=function(){var self=this;return $truthy(self["$closed_write?"]())?self.$raise(Opal.const_get_relative($nesting,"IOError"),"not opened for writing"):nil},TMP_StringIO_check_writable_17.$$arity=0),Opal.defn(self,"$check_readable",TMP_StringIO_check_readable_18=function(){var self=this;return $truthy(self["$closed_read?"]())?self.$raise(Opal.const_get_relative($nesting,"IOError"),"not opened for reading"):nil},TMP_StringIO_check_readable_18.$$arity=0),nil&&"check_readable"}($nesting[0],Opal.const_get_relative($nesting,"IO"),$nesting)},Opal.modules["open-uri"]=function(Opal){function $rb_minus(lhs,rhs){return"number"==typeof lhs&&"number"==typeof rhs?lhs-rhs:lhs["$-"](rhs)}function $rb_plus(lhs,rhs){return"number"==typeof lhs&&"number"==typeof rhs?lhs+rhs:lhs["$+"](rhs)}var self=Opal.top,$nesting=[],nil=Opal.nil,$module=(Opal.breaker,Opal.slice,Opal.module),$truthy=Opal.truthy,$send=Opal.send,$hash2=Opal.hash2,$klass=Opal.klass;return Opal.add_stubs(["$require","$private","$respond_to?","$=~","$open_uri","$to_proc","$open_uri_original_open","$module_function","$open_loop","$rewind","$close_io","$close!","$closed?","$close","$request","$==","$build_response","$raise","$new","$<<","$io","$status=","$-","$meta_add_field","$attr_reader","$+","$length","$===","$init","$extend","$instance_eval","$status","$base_uri","$base_uri=","$each","$metas","$meta_add_field2","$attr_accessor","$charset","$find_encoding","$set_encoding","$force_encoding","$string","$find","$downcase","$[]=","$join","$meta_setup_encoding","$[]","$utc","$at","$content_type_parse","$scheme","$open","$read"]),self.$require("stringio"),function($base,$parent_nesting){var $Kernel,TMP_Kernel_open_1,self=$Kernel=$module($base,"Kernel"),$nesting=(self.$$proto,[self].concat($parent_nesting));self.$private(),Opal.alias(self,"open_uri_original_open","open"),function(self,$parent_nesting){self.$$proto,[self].concat($parent_nesting);return Opal.alias(self,"open_uri_original_open","open")}(Opal.get_singleton_class(self),$nesting),Opal.defn(self,"$open",TMP_Kernel_open_1=function(name){var $b,rest,self=this,$iter=TMP_Kernel_open_1.$$p,block=$iter||nil,$args_len=arguments.length,$rest_len=$args_len-1;0>$rest_len&&($rest_len=0),rest=new Array($rest_len);for(var $arg_idx=1;$args_len>$arg_idx;$arg_idx++)rest[$arg_idx-1]=arguments[$arg_idx];return $iter&&(TMP_Kernel_open_1.$$p=null),$truthy($truthy($b=name["$respond_to?"]("to_str"))?/^[A-Za-z][A-Za-z0-9+\-\.]*:\/\//["$=~"](name):$b)?$send(Opal.const_get_relative($nesting,"OpenURI"),"open_uri",[name].concat(Opal.to_a(rest)),block.$to_proc()):$send(self,"open_uri_original_open",[name].concat(Opal.to_a(rest)),block.$to_proc())},TMP_Kernel_open_1.$$arity=-2),self.$module_function("open")}($nesting[0],$nesting),function($base,$parent_nesting){var $OpenURI,TMP_OpenURI_open_uri_2,TMP_OpenURI_close_io_3,TMP_OpenURI_open_loop_4,TMP_OpenURI_build_response_5,TMP_OpenURI_request_6,self=$OpenURI=$module($base,"OpenURI"),$nesting=(self.$$proto,[self].concat($parent_nesting));Opal.defs(self,"$open_uri",TMP_OpenURI_open_uri_2=function(name){var rest,self=this,$iter=TMP_OpenURI_open_uri_2.$$p,$yield=$iter||nil,io=nil,$args_len=arguments.length,$rest_len=$args_len-1;0>$rest_len&&($rest_len=0),rest=new Array($rest_len);for(var $arg_idx=1;$args_len>$arg_idx;$arg_idx++)rest[$arg_idx-1]=arguments[$arg_idx];return $iter&&(TMP_OpenURI_open_uri_2.$$p=null),io=self.$open_loop(name,$hash2([],{})),io.$rewind(),$yield!==nil?function(){try{return Opal.yield1($yield,io)}finally{self.$close_io(io)}}():io},TMP_OpenURI_open_uri_2.$$arity=-2),Opal.defs(self,"$close_io",TMP_OpenURI_close_io_3=function(io){return $truthy(io["$respond_to?"]("close!"))?io["$close!"]():$truthy(io["$closed?"]())?nil:io.$close()},TMP_OpenURI_close_io_3.$$arity=1),Opal.defs(self,"$open_loop",TMP_OpenURI_open_loop_4=function(uri){var $a,$b,self=this,req=nil,data=nil,status=nil,status_text=nil;return req=self.$request(uri),data=req.responseText,status=req.status,status_text=req.statusText&&req.statusText.errno?req.statusText.errno:req.statusText,$truthy($truthy($a=status["$=="](200))?$a:($b=status["$=="](0))?data:status["$=="](0))?self.$build_response(req,data,status,status_text):self.$raise(Opal.const_get_qualified(Opal.const_get_relative($nesting,"OpenURI"),"HTTPError").$new(""+status+" "+status_text,""))},TMP_OpenURI_open_loop_4.$$arity=2),Opal.defs(self,"$build_response",TMP_OpenURI_build_response_5=function(req,data,status,status_text){var buf=nil,io=nil,$writer=nil,last_modified=nil;return buf=Opal.const_get_relative($nesting,"Buffer").$new(),buf["$<<"](data),io=buf.$io(),$writer=[""+status+" "+status_text],$send(io,"status=",Opal.to_a($writer)),$writer[$rb_minus($writer.length,1)],io.$meta_add_field("content-type",req.getResponseHeader("Content-Type")),last_modified=req.getResponseHeader("Last-Modified"),$truthy(last_modified)&&io.$meta_add_field("last-modified",last_modified),io},TMP_OpenURI_build_response_5.$$arity=4),Opal.defs(self,"$request",TMP_OpenURI_request_6=function(uri){var self=this;try{var xhr=new XMLHttpRequest;return xhr.open("GET",uri,!1),xhr.send(),xhr}catch(error){self.$raise(Opal.const_get_qualified(Opal.const_get_relative($nesting,"OpenURI"),"HTTPError").$new(error.message,""))}},TMP_OpenURI_request_6.$$arity=1),function($base,$super,$parent_nesting){function $HTTPError(){}{var TMP_HTTPError_initialize_7,self=$HTTPError=$klass($base,$super,"HTTPError",$HTTPError);self.$$proto,[self].concat($parent_nesting)}return Opal.defn(self,"$initialize",TMP_HTTPError_initialize_7=function(message,io){var self=this,$iter=TMP_HTTPError_initialize_7.$$p;return $iter&&(TMP_HTTPError_initialize_7.$$p=null),$send(self,Opal.find_super_dispatcher(self,"initialize",TMP_HTTPError_initialize_7,!1),[message,io],null),self.io=io},TMP_HTTPError_initialize_7.$$arity=2),self.$attr_reader("io")}($nesting[0],Opal.const_get_relative($nesting,"StandardError"),$nesting),function($base,$super,$parent_nesting){function $Buffer(){}var TMP_Buffer_initialize_8,TMP_Buffer_$lt$lt_9,TMP_Buffer_io_10,self=$Buffer=$klass($base,$super,"Buffer",$Buffer),def=self.$$proto,$nesting=[self].concat($parent_nesting);return def.io=def.size=nil,Opal.defn(self,"$initialize",TMP_Buffer_initialize_8=function(){var self=this;return self.io=Opal.const_get_relative($nesting,"StringIO").$new(),self.size=0},TMP_Buffer_initialize_8.$$arity=0),self.$attr_reader("size"),Opal.defn(self,"$<<",TMP_Buffer_$lt$lt_9=function(str){var self=this;return self.io["$<<"](str),self.size=$rb_plus(self.size,str.$length())},TMP_Buffer_$lt$lt_9.$$arity=1),Opal.defn(self,"$io",TMP_Buffer_io_10=function(){var self=this;return $truthy(Opal.const_get_relative($nesting,"Meta")["$==="](self.io))||Opal.const_get_relative($nesting,"Meta").$init(self.io),self.io},TMP_Buffer_io_10.$$arity=0),nil&&"io"}($nesting[0],null,$nesting),function($base,$parent_nesting){var $Meta,TMP_Meta_init_13,TMP_Meta_meta_setup_encoding_14,TMP_Meta_set_encoding_15,TMP_Meta_find_encoding_16,TMP_Meta_meta_add_field2_17,TMP_Meta_meta_add_field_18,TMP_Meta_last_modified_19,TMP_Meta_content_type_parse_20,TMP_Meta_charset_21,TMP_Meta_content_type_22,self=$Meta=$module($base,"Meta"),$nesting=(self.$$proto,[self].concat($parent_nesting));Opal.defs(Opal.const_get_relative($nesting,"Meta"),"$init",TMP_Meta_init_13=function(obj,src){var TMP_11,TMP_12,self=this,$writer=nil;return null==src&&(src=nil),obj.$extend(Opal.const_get_relative($nesting,"Meta")),$send(obj,"instance_eval",[],(TMP_11=function(){var self=TMP_11.$$s||this;return self.base_uri=nil,self.meta=$hash2([],{}),self.metas=$hash2([],{})},TMP_11.$$s=self,TMP_11.$$arity=0,TMP_11)),$truthy(src)?($writer=[src.$status()],$send(obj,"status=",Opal.to_a($writer)),$writer[$rb_minus($writer.length,1)],$writer=[src.$base_uri()],$send(obj,"base_uri=",Opal.to_a($writer)),$writer[$rb_minus($writer.length,1)],$send(src.$metas(),"each",[],(TMP_12=function(name,values){TMP_12.$$s||this;return null==name&&(name=nil),null==values&&(values=nil),obj.$meta_add_field2(name,values)},TMP_12.$$s=self,TMP_12.$$arity=2,TMP_12))):nil},TMP_Meta_init_13.$$arity=-2),self.$attr_accessor("status"),self.$attr_accessor("base_uri"),self.$attr_reader("meta"),self.$attr_reader("metas"),Opal.defn(self,"$meta_setup_encoding",TMP_Meta_meta_setup_encoding_14=function(){var self=this,charset=nil,enc=nil;return charset=self.$charset(),enc=self.$find_encoding(charset),self.$set_encoding(enc)},TMP_Meta_meta_setup_encoding_14.$$arity=0),Opal.defn(self,"$set_encoding",TMP_Meta_set_encoding_15=function(enc){var self=this;return $truthy(self["$respond_to?"]("force_encoding"))?self.$force_encoding(enc):$truthy(self["$respond_to?"]("string"))?self.$string().$force_encoding(enc):self.$set_encoding(enc)},TMP_Meta_set_encoding_15.$$arity=1),Opal.defn(self,"$find_encoding",TMP_Meta_find_encoding_16=function(charset){var enc=nil;if(enc=nil,$truthy(charset))try{enc=Opal.const_get_relative($nesting,"Encoding").$find(charset)}catch($err){if(!Opal.rescue($err,[Opal.const_get_relative($nesting,"ArgumentError")]))throw $err;try{}finally{Opal.pop_exception()}}return $truthy(enc)||(enc=Opal.const_get_qualified(Opal.const_get_relative($nesting,"Encoding"),"ASCII_8BIT")),enc},TMP_Meta_find_encoding_16.$$arity=1),Opal.defn(self,"$meta_add_field2",TMP_Meta_meta_add_field2_17=function(name,values){var self=this,$writer=nil;return null==self.metas&&(self.metas=nil),null==self.meta&&(self.meta=nil),name=name.$downcase(),$writer=[name,values],$send(self.metas,"[]=",Opal.to_a($writer)),$writer[$rb_minus($writer.length,1)],$writer=[name,values.$join(", ")],$send(self.meta,"[]=",Opal.to_a($writer)),$writer[$rb_minus($writer.length,1)],name["$=="]("content-type")?self.$meta_setup_encoding():nil},TMP_Meta_meta_add_field2_17.$$arity=2),Opal.defn(self,"$meta_add_field",TMP_Meta_meta_add_field_18=function(name,value){var self=this;return self.$meta_add_field2(name,[value])},TMP_Meta_meta_add_field_18.$$arity=2),Opal.defn(self,"$last_modified",TMP_Meta_last_modified_19=function(){var self=this,vs=nil;return null==self.metas&&(self.metas=nil),$truthy(vs=self.metas["$[]"]("last-modified"))?Opal.const_get_relative($nesting,"Time").$at(Date.parse(vs.$join(", "))/1e3).$utc():nil},TMP_Meta_last_modified_19.$$arity=0),Opal.defn(self,"$content_type_parse",TMP_Meta_content_type_parse_20=function(){var self=this,content_type=nil;return null==self.metas&&(self.metas=nil),content_type=self.metas["$[]"]("content-type"),content_type.$join(", ")},TMP_Meta_content_type_parse_20.$$arity=0),Opal.defn(self,"$charset",TMP_Meta_charset_21=function(){var $a,$b,$c,self=this,type=nil;return null==self.base_uri&&(self.base_uri=nil),type=self.$content_type_parse(),$truthy($truthy($a=$truthy($b=$truthy($c=type)?/^text\//["$=~"](type):$c)?self.base_uri:$b)?/^http$/i["$=~"](self.base_uri.$scheme()):$a)?"iso-8859-1":nil},TMP_Meta_charset_21.$$arity=0),Opal.defn(self,"$content_type",TMP_Meta_content_type_22=function(){var $a,self=this,type=nil;return type=self.$content_type_parse(),$truthy($a=type)?$a:"application/octet-stream"},TMP_Meta_content_type_22.$$arity=0)}($nesting[0],$nesting),function($base,$parent_nesting){var $OpenRead,TMP_OpenRead_open_23,TMP_OpenRead_read_25,self=$OpenRead=$module($base,"OpenRead"),$nesting=(self.$$proto,[self].concat($parent_nesting));Opal.defn(self,"$open",TMP_OpenRead_open_23=function(){var rest,self=this,$iter=TMP_OpenRead_open_23.$$p,block=$iter||nil,$args_len=arguments.length,$rest_len=$args_len-0;0>$rest_len&&($rest_len=0),rest=new Array($rest_len);for(var $arg_idx=0;$args_len>$arg_idx;$arg_idx++)rest[$arg_idx-0]=arguments[$arg_idx];return $iter&&(TMP_OpenRead_open_23.$$p=null),$send(Opal.const_get_relative($nesting,"OpenURI"),"open_uri",[self].concat(Opal.to_a(rest)),block.$to_proc())},TMP_OpenRead_open_23.$$arity=-1),Opal.defn(self,"$read",TMP_OpenRead_read_25=function(options){var TMP_24,self=this;return null==options&&(options=$hash2([],{})),$send(self,"open",[options],(TMP_24=function(f){var str=(TMP_24.$$s||this,nil);return null==f&&(f=nil),str=f.$read(),Opal.const_get_relative($nesting,"Meta").$init(str,f),str},TMP_24.$$s=self,TMP_24.$$arity=1,TMP_24))},TMP_OpenRead_read_25.$$arity=-1)}($nesting[0],$nesting)}($nesting[0],$nesting)};